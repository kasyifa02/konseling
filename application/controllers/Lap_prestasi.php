<?php

if (!defined('BASEPATH'))
    exit('No direct script access allowed');

class Lap_prestasi extends CI_Controller
{
    function __construct()
    {
        parent::__construct();
        is_logged_in();
        $this->load->model('Prestasi_model');
        $this->load->library('form_validation');
    }

    public function index()
    {
        $prestasi = "";
        $level = $this->session->userdata('id_user_level');
        if ($level == 9) {
            $this->db->where("kelas", $this->session->userdata('id_kelas'));
            $prestasi = $this->db->get('tbl_prestasi')->result();
        } elseif ($level == 12) {
            $this->db->order_by("kelas", "ASC");
            $prestasi = $this->db->get('tbl_prestasi')->result();
        } else {
            $this->db->where("username", $this->session->userdata('id_kelas'));
            $prestasi = $this->db->get('tbl_prestasi')->result();
        }

        $data = array(
            'prestasi_data' => $prestasi,
            'start' => 1

        );
        $data['title'] = 'Prestasi';
        $data['user'] = $this->db->get_where('tbl_user', ['username' => $this->session->userdata('username')])->row_array();

        $this->load->view('templates/header', $data);
        $this->load->view('templates/sidebar', $data);
        $this->load->view('templates/topbar', $data);
        $this->load->view('all_ortu/tbl_prestasi_list_ortu', $data);
        $this->load->view('templates/footer', $data);
    }
    public function read($id)
    {
        $row = $this->Prestasi_model->get_by_id($id);
        if ($row) {
            $data = array(
                'id' => $row->id,
                'username' => $row->username,
                'prestasi' => $row->prestasi,
                'kelas' => $row->kelas,
                'tgl' => $row->tgl,
            );
            $data['title'] = 'Prestasi';
            $data['user'] = $this->db->get_where('tbl_user', ['username' => $this->session->userdata('username')])->row_array();

            $this->load->view('templates/header', $data);
            $this->load->view('templates/sidebar', $data);
            $this->load->view('templates/topbar', $data);
            $this->load->view('all_ortu/tbl_prestasi_read_ortu', $data);
            $this->load->view('templates/footer', $data);
        } else {
            $this->session->set_flashdata('message', 'Record Not Found');
            redirect(site_url('lap_prestasi'));
        }
    }

    public function cetak()
    {
        // Create an instance of the class:
        $mpdf = new \Mpdf\Mpdf();
        $dari = $this->input->post('dari');
        $sampai = $this->input->post('sampai');
        $result = "";
        if ($dari == "" or $sampai == "") {
            $result = $this->db->query("SELECT * FROM tbl_prestasi")->result();
        } else {
            $result = $this->db->query("SELECT * FROM tbl_prestasi WHERE tgl BETWEEN '$dari' AND '$sampai'")->result();
        }

        $data = [
            "data_materi" => $result,
            "title" => "LAPORAN PRESTASI SISWA",
        ];
        $html = $this->load->view('cetak/cetak', $data, true);
        $mpdf->WriteHTML($html);
        $mpdf->Output();
    }

    public function print($id = null)
    {
        // Create an instance of the class:
        $mpdf = new \Mpdf\Mpdf();
        $dari = $this->input->post('dari');
        $sampai = $this->input->post('sampai');
        $result = "";
        if ($dari == "" or $sampai == "") {
            $result = $this->db->query("SELECT * FROM tbl_prestasi WHERE username='$id'")->result();
        } else {
            $result = $this->db->query("SELECT * FROM tbl_prestasi WHERE tgl BETWEEN '$dari' AND '$sampai' AND username='$id'")->result();
        }

        $data = [
            "data_materi" => $result,
            "title" => "LAPORAN PRESTASI SISWA",
        ];
        $html = $this->load->view('cetak/cetak', $data, true);
        $mpdf->WriteHTML($html);
        $mpdf->Output();
    }
}

/* End of file prestasi.php */
/* Location: ./application/controllers/prestasi.php */
/* Please DO NOT modify this information : */
/* Generated by Harviacode Codeigniter CRUD Generator 2021-07-28 09:45:48 */
/* http://harviacode.com */